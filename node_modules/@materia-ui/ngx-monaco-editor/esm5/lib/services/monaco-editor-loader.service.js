/**
 * @fileoverview added by tsickle
 * Generated from: lib/services/monaco-editor-loader.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Injectable, NgZone, Optional, Inject } from '@angular/core';
import { BehaviorSubject } from 'rxjs';
import { MONACO_PATH } from '../interfaces';
import * as i0 from "@angular/core";
import * as ɵngcc0 from '@angular/core';
var MonacoEditorLoaderService = /** @class */ (function () {
    function MonacoEditorLoaderService(ngZone, monacoPathConfig) {
        var _this = this;
        this.ngZone = ngZone;
        this.monacoPathConfig = monacoPathConfig;
        this.isMonacoLoaded$ = new BehaviorSubject(false);
        this._monacoPath = 'assets/monaco-editor/min/vs';
        if (((/** @type {?} */ (window))).monacoEditorAlreadyInitialized) {
            ngZone.run((/**
             * @return {?}
             */
            function () { return _this.isMonacoLoaded$.next(true); }));
            return;
        }
        ((/** @type {?} */ (window))).monacoEditorAlreadyInitialized = true;
        if (this.monacoPathConfig) {
            this.monacoPath = this.monacoPathConfig;
        }
        this.loadMonaco();
    }
    Object.defineProperty(MonacoEditorLoaderService.prototype, "monacoPath", {
        set: /**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            if (value) {
                this._monacoPath = value;
            }
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @return {?}
     */
    MonacoEditorLoaderService.prototype.loadMonaco = /**
     * @return {?}
     */
    function () {
        var _this = this;
        /** @type {?} */
        var onGotAmdLoader = (/**
         * @return {?}
         */
        function () {
            // Load monaco
            ((/** @type {?} */ (window))).amdRequire = ((/** @type {?} */ (window))).require;
            if (_this.nodeRequire) {
                ((/** @type {?} */ (window))).require = _this.nodeRequire;
            }
            ((/** @type {?} */ (window))).amdRequire.config({ paths: { 'vs': _this._monacoPath } });
            ((/** @type {?} */ (window))).amdRequire(['vs/editor/editor.main'], (/**
             * @return {?}
             */
            function () {
                _this.ngZone.run((/**
                 * @return {?}
                 */
                function () { return _this.isMonacoLoaded$.next(true); }));
            }));
        });
        /** @type {?} */
        var loaderScript = null;
        // Load AMD loader if necessary
        if (!((/** @type {?} */ (window))).require && !((/** @type {?} */ (window))).amdRequire) {
            loaderScript = document.createElement('script');
            loaderScript.type = 'text/javascript';
            loaderScript.src = this._monacoPath + "/loader.js";
            loaderScript.addEventListener('load', onGotAmdLoader);
            document.body.appendChild(loaderScript);
        }
        else if (!((/** @type {?} */ (window))).amdRequire) {
            this.addElectronFixScripts();
            this.nodeRequire = ((/** @type {?} */ (window))).require;
            loaderScript = document.createElement('script');
            loaderScript.type = 'text/javascript';
            loaderScript.src = this._monacoPath + "/loader.js";
            loaderScript.addEventListener('load', onGotAmdLoader);
            document.body.appendChild(loaderScript);
        }
        else {
            onGotAmdLoader();
        }
    };
    /**
     * @return {?}
     */
    MonacoEditorLoaderService.prototype.addElectronFixScripts = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var electronFixScript = document.createElement('script');
        // workaround monaco-css not understanding the environment
        /** @type {?} */
        var inlineScript = document.createTextNode('self.module = undefined;');
        // workaround monaco-typescript not understanding the environment
        /** @type {?} */
        var inlineScript2 = document.createTextNode('self.process.browser = true;');
        electronFixScript.appendChild(inlineScript);
        electronFixScript.appendChild(inlineScript2);
        document.body.appendChild(electronFixScript);
    };
    /** @nocollapse */
    MonacoEditorLoaderService.ctorParameters = function () { return [
        { type: NgZone },
        { type: String, decorators: [{ type: Optional }, { type: Inject, args: [MONACO_PATH,] }] }
    ]; };
    /** @nocollapse */ MonacoEditorLoaderService.ngInjectableDef = i0.ɵɵdefineInjectable({ factory: function MonacoEditorLoaderService_Factory() { return new MonacoEditorLoaderService(i0.ɵɵinject(i0.NgZone), i0.ɵɵinject("MONACO_PATH", 8)); }, token: MonacoEditorLoaderService, providedIn: "root" });
MonacoEditorLoaderService.ɵfac = function MonacoEditorLoaderService_Factory(t) { return new (t || MonacoEditorLoaderService)(ɵngcc0.ɵɵinject(ɵngcc0.NgZone), ɵngcc0.ɵɵinject(MONACO_PATH, 8)); };
MonacoEditorLoaderService.ɵprov = ɵngcc0.ɵɵdefineInjectable({ token: MonacoEditorLoaderService, factory: function (t) { return MonacoEditorLoaderService.ɵfac(t); }, providedIn: 'root' });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(MonacoEditorLoaderService, [{
        type: Injectable,
        args: [{ providedIn: 'root' }]
    }], function () { return [{ type: ɵngcc0.NgZone }, { type: String, decorators: [{
                type: Optional
            }, {
                type: Inject,
                args: [MONACO_PATH]
            }] }]; }, null); })();
    return MonacoEditorLoaderService;
}());
export { MonacoEditorLoaderService };
if (false) {
    /** @type {?} */
    MonacoEditorLoaderService.prototype.nodeRequire;
    /** @type {?} */
    MonacoEditorLoaderService.prototype.isMonacoLoaded$;
    /**
     * @type {?}
     * @private
     */
    MonacoEditorLoaderService.prototype._monacoPath;
    /**
     * @type {?}
     * @private
     */
    MonacoEditorLoaderService.prototype.ngZone;
    /** @type {?} */
    MonacoEditorLoaderService.prototype.monacoPathConfig;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9uYWNvLWVkaXRvci1sb2FkZXIuc2VydmljZS5qcyIsInNvdXJjZXMiOlsiQG1hdGVyaWEtdWkvbmd4LW1vbmFjby1lZGl0b3IvbGliL3NlcnZpY2VzL21vbmFjby1lZGl0b3ItbG9hZGVyLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3JFLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDdkMsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUM1Qzs7QUFDQTtBQUN5QixJQVVyQixtQ0FBb0IsTUFBYyxFQUEwQyxnQkFBd0I7QUFDeEcsUUFESSxpQkFZQztBQUNMLFFBYndCLFdBQU0sR0FBTixNQUFNLENBQVE7QUFBQyxRQUF5QyxxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQVE7QUFBQyxRQVJyRyxvQkFBZSxHQUE2QixJQUFJLGVBQWUsQ0FBVSxLQUFLLENBQUMsQ0FBQztBQUNwRixRQUFZLGdCQUFXLEdBQUcsNkJBQTZCLENBQUM7QUFDeEQsUUFPTSxJQUFJLENBQUMsbUJBQUssTUFBTSxFQUFBLENBQUMsQ0FBQyw4QkFBOEIsRUFBRTtBQUN4RCxZQUFRLE1BQU0sQ0FBQyxHQUFHO0FBQU07QUFBMkI7QUFDM0MsWUFEVyxjQUFNLE9BQUEsS0FBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQS9CLENBQStCLEVBQUMsQ0FBQztBQUMxRCxZQUFRLE9BQU87QUFDZixTQUFPO0FBQ1AsUUFDTSxDQUFDLG1CQUFLLE1BQU0sRUFBQSxDQUFDLENBQUMsOEJBQThCLEdBQUcsSUFBSSxDQUFDO0FBQzFELFFBQ00sSUFBSSxJQUFJLENBQUMsZ0JBQWdCLEVBQUU7QUFDakMsWUFBUSxJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQyxnQkFBZ0IsQ0FB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O0FBZkEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFXQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFZQSxBQVpBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBUkEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQVFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBbEJBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFBQSxBQWdCQSxBQUFBLEFBQUEsQUFBQSxBQXFDQSxBQXBDQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBRUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUNBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFDQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUNBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQ0EsQUFBQSxBQXpFQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBSkEsQUFBQSxBQWVBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQWZBLEFBOEVBLEFBMUVBLEFBMEVBLEFBekVBLEFBQUEsQUFDQSxBQUFBLEFBQ0EsQUFBQSxBQUNBLEFBQUEsQUFPQSxBQUFBLEFBQUEsQUFBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUsIE5nWm9uZSwgT3B0aW9uYWwsIEluamVjdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQmVoYXZpb3JTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBNT05BQ09fUEFUSCB9IGZyb20gJy4uL2ludGVyZmFjZXMnO1xuXG5ASW5qZWN0YWJsZSh7IHByb3ZpZGVkSW46ICdyb290JyB9KVxuZXhwb3J0IGNsYXNzIE1vbmFjb0VkaXRvckxvYWRlclNlcnZpY2Uge1xuICAgIG5vZGVSZXF1aXJlOiBhbnk7XG4gICAgaXNNb25hY29Mb2FkZWQkOiBCZWhhdmlvclN1YmplY3Q8Ym9vbGVhbj4gPSBuZXcgQmVoYXZpb3JTdWJqZWN0PGJvb2xlYW4+KGZhbHNlKTtcbiAgICBwcml2YXRlIF9tb25hY29QYXRoID0gJ2Fzc2V0cy9tb25hY28tZWRpdG9yL21pbi92cyc7XG4gICAgc2V0IG1vbmFjb1BhdGgodmFsdWU6IHN0cmluZykge1xuICAgICAgICBpZiAodmFsdWUpIHtcbiAgICAgICAgICAgIHRoaXMuX21vbmFjb1BhdGggPSB2YWx1ZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgbmdab25lOiBOZ1pvbmUsIEBPcHRpb25hbCgpIEBJbmplY3QoTU9OQUNPX1BBVEgpIHB1YmxpYyBtb25hY29QYXRoQ29uZmlnOiBzdHJpbmcpIHtcbiAgICAgIGlmICgoPGFueT53aW5kb3cpLm1vbmFjb0VkaXRvckFscmVhZHlJbml0aWFsaXplZCkge1xuICAgICAgICBuZ1pvbmUucnVuKCgpID0+IHRoaXMuaXNNb25hY29Mb2FkZWQkLm5leHQodHJ1ZSkpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgICg8YW55PndpbmRvdykubW9uYWNvRWRpdG9yQWxyZWFkeUluaXRpYWxpemVkID0gdHJ1ZTtcblxuICAgICAgaWYgKHRoaXMubW9uYWNvUGF0aENvbmZpZykge1xuICAgICAgICB0aGlzLm1vbmFjb1BhdGggPSB0aGlzLm1vbmFjb1BhdGhDb25maWc7XG4gICAgICB9XG4gICAgICB0aGlzLmxvYWRNb25hY28oKTtcbiAgICB9XG5cbiAgICBsb2FkTW9uYWNvKCkge1xuICAgICAgY29uc3Qgb25Hb3RBbWRMb2FkZXIgPSAoKSA9PiB7XG4gICAgICAgIC8vIExvYWQgbW9uYWNvXG4gICAgICAgICg8YW55PndpbmRvdykuYW1kUmVxdWlyZSA9ICAoPGFueT53aW5kb3cpLnJlcXVpcmU7XG4gICAgICAgIGlmICh0aGlzLm5vZGVSZXF1aXJlKSB7XG4gICAgICAgICAgICAoPGFueT53aW5kb3cpLnJlcXVpcmUgPSB0aGlzLm5vZGVSZXF1aXJlO1xuICAgICAgICB9XG4gICAgICAgICg8YW55PndpbmRvdykuYW1kUmVxdWlyZS5jb25maWcoeyBwYXRoczogeyAndnMnOiB0aGlzLl9tb25hY29QYXRoIH0gfSk7XG4gICAgICAgICg8YW55PndpbmRvdykuYW1kUmVxdWlyZShbJ3ZzL2VkaXRvci9lZGl0b3IubWFpbiddLCAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLm5nWm9uZS5ydW4oKCkgPT4gdGhpcy5pc01vbmFjb0xvYWRlZCQubmV4dCh0cnVlKSk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBsZXQgbG9hZGVyU2NyaXB0OiBhbnkgPSBudWxsO1xuICAgIC8vIExvYWQgQU1EIGxvYWRlciBpZiBuZWNlc3NhcnlcbiAgICBpZiAoISg8YW55PndpbmRvdykucmVxdWlyZSAmJiAhKDxhbnk+d2luZG93KS5hbWRSZXF1aXJlKSB7XG5cbiAgICAgICAgbG9hZGVyU2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7XG4gICAgICAgIGxvYWRlclNjcmlwdC50eXBlID0gJ3RleHQvamF2YXNjcmlwdCc7XG4gICAgICAgIGxvYWRlclNjcmlwdC5zcmMgPSBgJHt0aGlzLl9tb25hY29QYXRofS9sb2FkZXIuanNgO1xuICAgICAgICBsb2FkZXJTY3JpcHQuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsIG9uR290QW1kTG9hZGVyKTtcbiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChsb2FkZXJTY3JpcHQpO1xuXG4gICAgfSBlbHNlIGlmICghKDxhbnk+d2luZG93KS5hbWRSZXF1aXJlKSB7XG5cbiAgICAgICAgdGhpcy5hZGRFbGVjdHJvbkZpeFNjcmlwdHMoKTtcblxuICAgICAgICB0aGlzLm5vZGVSZXF1aXJlID0gICg8YW55PndpbmRvdykucmVxdWlyZTtcbiAgICAgICAgbG9hZGVyU2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7XG4gICAgICAgIGxvYWRlclNjcmlwdC50eXBlID0gJ3RleHQvamF2YXNjcmlwdCc7XG4gICAgICAgIGxvYWRlclNjcmlwdC5zcmMgPSBgJHt0aGlzLl9tb25hY29QYXRofS9sb2FkZXIuanNgO1xuICAgICAgICBsb2FkZXJTY3JpcHQuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsIG9uR290QW1kTG9hZGVyKTtcbiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChsb2FkZXJTY3JpcHQpO1xuXG4gICAgfSBlbHNlIHtcbiAgICAgICAgb25Hb3RBbWRMb2FkZXIoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBhZGRFbGVjdHJvbkZpeFNjcmlwdHMoKSB7XG4gICAgICAgIGNvbnN0IGVsZWN0cm9uRml4U2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7XG4gICAgICAgIC8vIHdvcmthcm91bmQgbW9uYWNvLWNzcyBub3QgdW5kZXJzdGFuZGluZyB0aGUgZW52aXJvbm1lbnRcbiAgICAgICAgY29uc3QgaW5saW5lU2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ3NlbGYubW9kdWxlID0gdW5kZWZpbmVkOycpO1xuICAgICAgICAvLyB3b3JrYXJvdW5kIG1vbmFjby10eXBlc2NyaXB0IG5vdCB1bmRlcnN0YW5kaW5nIHRoZSBlbnZpcm9ubWVudFxuICAgICAgICBjb25zdCBpbmxpbmVTY3JpcHQyID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoJ3NlbGYucHJvY2Vzcy5icm93c2VyID0gdHJ1ZTsnKTtcbiAgICAgICAgZWxlY3Ryb25GaXhTY3JpcHQuYXBwZW5kQ2hpbGQoaW5saW5lU2NyaXB0KTtcbiAgICAgICAgZWxlY3Ryb25GaXhTY3JpcHQuYXBwZW5kQ2hpbGQoaW5saW5lU2NyaXB0Mik7XG4gICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZWxlY3Ryb25GaXhTY3JpcHQpO1xuICAgIH1cbn1cbiJdfQ==